"use client"; import React, { useEffect, useState } from 'react'; const WakaTimeStats = () => { const [stats, setStats] = useState(null); const [summary, setSummary] = useState(null); const [loading, setLoading] = useState(true); const [error, setError] = useState(null); const [range, setRange] = useState('last_7_days'); useEffect(() => { fetchWakaTimeData(); }, [range]); const fetchWakaTimeData = async () => { try { setLoading(true); const [statsRes, summaryRes] = await Promise.all([ fetch(`/api/wakatime/stats?range=${range}`), fetch(`/api/wakatime/summary?range=${range}`), ]); const statsData = await statsRes.json(); const summaryData = await summaryRes.json(); if (statsData.error) { throw new Error(statsData.error); } setStats(statsData.data); setSummary(summaryData.data); } catch (err) { setError(err.message); console.error('Error fetching WakaTime data:', err); } finally { setLoading(false); } }; const formatTime = (seconds) => { if (!seconds) return '0 mins'; const hours = Math.floor(seconds / 3600); const minutes = Math.floor((seconds % 3600) / 60); if (hours > 0) { return `${hours} hr${hours > 1 ? 's' : ''} ${minutes} min${minutes !== 1 ? 's' : ''}`; } return `${minutes} min${minutes !== 1 ? 's' : ''}`; }; const formatDate = (dateString) => { if (!dateString) return ''; return new Date(dateString).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', }); }; if (loading) { return ( <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-6"> <div className="animate-pulse space-y-4"> <div className="h-6 bg-neutral-300 dark:bg-neutral-700 rounded w-1/3"></div> <div className="grid grid-cols-2 gap-4"> {Array.from({ length: 6 }).map((_, i) => ( <div key={i} className="h-20 bg-neutral-300 dark:bg-neutral-700 rounded"></div> ))} </div> </div> </div> ); } if (error || !stats) { return ( <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-6"> <p className="text-neutral-600 dark:text-neutral-400"> Unable to load WakaTime stats. Please check your API configuration. </p> </div> ); } const rangeLabels = { last_7_days: 'Last 7 Days', last_30_days: 'Last 30 Days', all_time: 'All Time', }; return ( <div className="space-y-6"> {/* Range Selector */} <div className="flex items-center justify-between"> <div> <h2 className="text-xl font-medium text-neutral-800 dark:text-neutral-300 mb-2"> WakaTime Coding Activity </h2> <p className="text-sm text-neutral-600 dark:text-neutral-400"> Track your coding time, languages, and productivity metrics </p> </div> <select value={range} onChange={(e) => setRange(e.target.value)} className="px-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100" > <option value="last_7_days">Last 7 Days</option> <option value="last_30_days">Last 30 Days</option> <option value="all_time">All Time</option> </select> </div> {/* Stats Cards */} <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-4"> <span className="text-sm text-neutral-600 dark:text-neutral-400">Total Coding Time</span> <div className="text-2xl font-semibold text-green-600 dark:text-green-400 mt-1"> {formatTime(stats.total_seconds_including_other_language)} </div> </div> <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-4"> <span className="text-sm text-neutral-600 dark:text-neutral-400">Daily Average</span> <div className="text-2xl font-semibold text-blue-600 dark:text-blue-400 mt-1"> {formatTime(stats.daily_average)} </div> </div> <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-4"> <span className="text-sm text-neutral-600 dark:text-neutral-400">Best Day</span> <div className="text-lg font-semibold text-purple-600 dark:text-purple-400 mt-1"> {formatTime(stats.best_day?.total_seconds)} </div> <div className="text-xs text-neutral-500 dark:text-neutral-500 mt-1"> {formatDate(stats.best_day?.date)} </div> </div> </div> {/* Languages */} {stats.languages && stats.languages.length > 0 && ( <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-6"> <h3 className="text-lg font-medium text-neutral-800 dark:text-neutral-300 mb-4"> Languages </h3> <div className="space-y-3"> {stats.languages.slice(0, 10).map((lang, index) => { const percentage = stats.total_seconds_including_other_language > 0 ? ((lang.total_seconds / stats.total_seconds_including_other_language) * 100).toFixed(1) : 0; return ( <div key={index} className="space-y-1"> <div className="flex justify-between text-sm"> <span className="text-neutral-700 dark:text-neutral-300">{lang.name}</span> <span className="text-neutral-600 dark:text-neutral-400"> {formatTime(lang.total_seconds)} ({percentage}%) </span> </div> <div className="w-full bg-neutral-200 dark:bg-neutral-700 rounded-full h-2"> <div className="bg-blue-500 h-2 rounded-full transition-all duration-300" style={{ width: `${percentage}%` }} /> </div> </div> ); })} </div> </div> )} {/* Editors */} {stats.editors && stats.editors.length > 0 && ( <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-6"> <h3 className="text-lg font-medium text-neutral-800 dark:text-neutral-300 mb-4"> Editors </h3> <div className="grid grid-cols-1 md:grid-cols-2 gap-4"> {stats.editors.slice(0, 6).map((editor, index) => { const percentage = stats.total_seconds_including_other_language > 0 ? ((editor.total_seconds / stats.total_seconds_including_other_language) * 100).toFixed(1) : 0; return ( <div key={index} className="space-y-1"> <div className="flex justify-between text-sm"> <span className="text-neutral-700 dark:text-neutral-300">{editor.name}</span> <span className="text-neutral-600 dark:text-neutral-400"> {formatTime(editor.total_seconds)} </span> </div> <div className="w-full bg-neutral-200 dark:bg-neutral-700 rounded-full h-2"> <div className="bg-green-500 h-2 rounded-full transition-all duration-300" style={{ width: `${percentage}%` }} /> </div> </div> ); })} </div> </div> )} {/* Operating Systems */} {stats.operating_systems && stats.operating_systems.length > 0 && ( <div className="rounded-2xl border-[1.5px] border-neutral-300 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900 p-6"> <h3 className="text-lg font-medium text-neutral-800 dark:text-neutral-300 mb-4"> Operating Systems </h3> <div className="grid grid-cols-1 md:grid-cols-3 gap-4"> {stats.operating_systems.map((os, index) => { const percentage = stats.total_seconds_including_other_language > 0 ? ((os.total_seconds / stats.total_seconds_including_other_language) * 100).toFixed(1) : 0; return ( <div key={index} className="space-y-1"> <div className="flex justify-between text-sm"> <span className="text-neutral-700 dark:text-neutral-300">{os.name}</span> <span className="text-neutral-600 dark:text-neutral-400"> {formatTime(os.total_seconds)} </span> </div> <div className="w-full bg-neutral-200 dark:bg-neutral-700 rounded-full h-2"> <div className="bg-purple-500 h-2 rounded-full transition-all duration-300" style={{ width: `${percentage}%` }} /> </div> </div> ); })} </div> </div> )} </div> ); }; export default WakaTimeStats;
