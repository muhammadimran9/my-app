"use client";

import React, { useState, useEffect } from 'react';
import { db } from '../lib/firebase';
import { collection, addDoc, getDocs } from 'firebase/firestore';

const FirebaseTest = () => {
  const [status, setStatus] = useState('Testing Firebase connection...');
  const [isConnected, setIsConnected] = useState(false);

  useEffect(() => {
    testFirebaseConnection();
  }, []);

  const testFirebaseConnection = async () => {
    try {
      // Try to read from a collection
      const querySnapshot = await getDocs(collection(db, 'test'));
      setStatus('✅ Firebase connection successful!');
      setIsConnected(true);
    } catch (error) {
      console.error('Firebase connection error:', error);
      setStatus(`❌ Firebase connection failed: ${error.message}`);
      setIsConnected(false);
    }
  };

  const testWrite = async () => {
    try {
      await addDoc(collection(db, 'test'), {
        message: 'Test message',
        timestamp: new Date().toISOString()
      });
      setStatus('✅ Firebase write test successful!');
    } catch (error) {
      console.error('Firebase write error:', error);
      setStatus(`❌ Firebase write failed: ${error.message}`);
    }
  };

  return (
    <div className="p-4 bg-neutral-800 rounded-lg">
      <h3 className="text-white font-bold mb-2">Firebase Connection Test</h3>
      <p className={`mb-4 ${isConnected ? 'text-green-400' : 'text-red-400'}`}>
        {status}
      </p>
      {isConnected && (
        <button
          onClick={testWrite}
          className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
        >
          Test Write Operation
        </button>
      )}
    </div>
  );
};

export default FirebaseTest;